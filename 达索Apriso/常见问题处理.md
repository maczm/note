# 解决锁表问题SQL

```sql
-- 查询哪些对象被锁
SELECT object_name, machine, s.sid, s.serial#
  FROM v$locked_object l,
       dba_objects o,
       v$session s
 WHERE l.object_id = o.object_id
   AND l.session_id = s.sid;

-- 杀死一个进程
ALTER SYSTEM KILL SESSION '2505,15039';
```

# 修改实体状态SQL

```sql
UPDATE OPERATION
SET RevisionStatusID = 4
WHERE OperationCode = 'LES_AutoSortTaskQuery.GridView';

UPDATE SF_LAYOUT
SET RevisionStatusID = 4
WHERE OperationCode = 'LES_AutoSortTaskQuery.GridView';;

UPDATE SF_SCREEN_REVISION
SET RevisionStatusID = 4
WHERE SCREENID = (SELECT ID
                  FROM FLXUSER.SF_VIEW
                  WHERE SF_VIEW.NAME = 'LES_AutoSortTaskQueryFilter.FormView');

UPDATE SF_VIEW_REVISION
SET RevisionStatusID = 4
WHERE VIEWID = (SELECT ID
                FROM FLXUSER.SF_VIEW
                WHERE SF_VIEW.NAME = 'LES_AutoSortTaskQueryFilter.FormView');
```



# CSharp匹配两个列表

```c#
Dictionary<string,int> map = new Dictionary<string,int>();
for (int i = 0; i < productIdList.Length;i++) 
{
	if (map.ContainsKey(productIdList[i])) 
	{
		int value = map[productIdList[i]] + quantityList[i];
		map[productIdList[i]] = value;
	}
	else
	{
		map.Add(productIdList[i], quantityList[i]);
	}
}
List<string> pList = new List<string>();
List<int> qList = new List<int>();
foreach (var dic in map)
{
	pList.Add(dic.Key);
	qList.Add(dic.Value);
}
productId = pList.ToArray();
quantity = qList.ToArray();
```

# JQuery处理下拉列表

```javascript
$(function(){
	$('.fc_LocationStatus select').find('option[value="1"]').attr("selected",true);
})
```

# CSharp条件筛选

```c#
if(!string.IsNullOrEmpty(WipOrderNo))
{
	string[] w= WipOrderNo.Split("\r\n,;".ToCharArray(),StringSplitOptions.RemoveEmptyEntries);
	if (w.Length > 0)
    {
        string wResult="";
		for(int i=0;i<w.Length;i++)
		{
			wResult+="'"+w[i].Trim()+"',";
		}
		wResult=wResult.Substring(0,wResult.Length-1);
		sqlWhere+="AND WO.WIPORDERNO IN ("+wResult+") ";
    }
}
//计划开始时间起始
if(!string.IsNullOrEmpty(ScheduledStartDateFm)&&!ScheduledStartDateFm.Contains("1900"))
{
	sqlWhere+=" AND (wo.scheduledstartdate + INTERVAL '8' HOUR) >= TO_DATE('"+DateTime.Parse(ScheduledStartDateFm).ToString("yyyy-MM-dd 00:00:00")+"','yyyy-MM-dd HH24:mi:ss')";
}

//计划开始时间止
if(!string.IsNullOrEmpty(ScheduledStartDateTo)&&!ScheduledStartDateTo.Contains("1900"))
{
	sqlWhere+=" AND (WO.scheduledstartdate + INTERVAL '8' HOUR)  < TO_DATE('"+DateTime.Parse(ScheduledStartDateTo).ToString("yyyy-MM-dd 23:59:59")+"','yyyy-MM-dd HH24:mi:ss')";
}
```

# CSharp时间处理

```c#
System.TimeSpan a = DateTime.UtcNow - new DateTime(1970,1,1,0,0,0,0);
Convert.ToInt64(a.TotalMilliseconds).ToString();
// =================================================
DateTime currentTime = DateTime.Now;
int week = Convert.ToInt32(currentTime.DayOfWeek);
week = week == 0 ? 7 : week;
 
//获取上周星期一/星期天
var start_time_last_week = currentTime.AddDays(1 - week - 7);//上周星期一
var end_time_last_week = currentTime.AddDays(7 - week - 7);//上周星期天
Console.WriteLine("上周:" + start_time_last_week + "|" + end_time_last_week);
 
//获取本周星期一/星期天
var start_time_current_week = currentTime.AddDays(1 - week);//本周星期一
var end_time_current_week = currentTime.AddDays(7 - week);//本周星期天
Console.WriteLine("本周:" + start_time_current_week + "|" + end_time_current_week);
 
//获取下周星期一/星期天
var start_time_next_week = currentTime.AddDays(1 - week + 7);//下周星期一
var end_time_next_week = currentTime.AddDays(7 - week + 7);//下周星期天
Console.WriteLine("下周：" + start_time_next_week + "|" + end_time_next_week);
 
//3-5;6-8;9-11;12-2
var startQuarter = currentTime.AddMonths(0 - (currentTime.Month % 3)).AddDays(1 - currentTime.Day);  //本季度初
var endQuarter = startQuarter.AddMonths(3).AddDays(-1);  //本季度末
 
//1-3;4-6;7-9;10-12
var startQuarter = currentTime.AddMonths(0 - (currentTime.Month - 1) % 3).AddDays(1 - currentTime.Day);  //本季度初
var endQuarter = startQuarter.AddMonths(3).AddDays(-1);  //本季度末
```

# Apriso修改Grid表格值

```javascript
$('.DynamicGrid').dgValueChange('xxx')
```

# Apriso下拉搜索功能

```html
<!-- 导入样式 -->
<link rel="stylesheet" type="text/css" href="[Apriso]/ModernUI/Controls/ModernUIAutoComplete/ModernUIAutoComplete.css" />
<!-- 导入js -->
<script src="[Apriso]/ModernUI/Controls/ModernUIAutoComplete/ModernUIAutoComplete.js"></script>

<!-- 对输入框进行操作 及联演示 API-->
<script>
$View.onLoaded(function () {
	var ProductGroup_ = '';
	$('.fc_ProductGroup input').modernUIAutocomplete({
        emptyOnLoad: true,
        context: $Context,
		'callbackSelected':function(val) {
				if(ProductGroup_ == val.keyword){
					return;
				}
				console.log('ProductGroup_ ==> ' ,val.keyword)
				ProductGroup_ = val.keyword;
        // 刷新数据
				PI[0].resetValue();
      	// 根据key值显示，flase不生效，key为空显示第一条数据
				PI[0].refreshData('<key>',true);
		}
    });
	var PI = $('.fc_ProductId input').modernUIAutocomplete({
        emptyOnLoad: true,
        context: $Context,
		'requestHandler': function (obj) {
				obj.inputs.json = JSON.stringify({
					ProductGroup :ProductGroup_
				})
				console.log(ProductGroup_);
                $Context.callOperation('Control_ModernUIAutocomplete_GetData', obj.inputs, function(data){ obj.pushData(data); }, function(data){obj.pushData(data); } );
            }
    });
  // 设置下拉列表不可选择
  PI[0].setDisable();
})
</script>
```

# CSharp处理JSON

```c#
//反序列化父JSON
dynamic Json = JsonConvert.DeserializeObject(JsonLocationState);

//序列化子JSON
string JsonSon = Newtonsoft.Json.JsonConvert.SerializeObject(Json.reported);

//反序列化子JSON
dynamic TaskInfo= Newtonsoft.Json.JsonConvert.DeserializeObject(JsonSon);
//反序列化父JSON
Newtonsoft.Json.Linq.JObject  JsonInputs = Newtonsoft.Json.JsonConvert.DeserializeObject<Newtonsoft.Json.Linq.JObject>(JsonObject);
```

# JavaScript处理JSON

```javascript
// json序列化
function json2str(o){
    var arr = [];
    var fmt = function(s) {
       if (typeof s == 'object' && s != null) {
           return json2str(s); //递归
       }
　　    //如果是数字或string
       return /^(string|number)$/.test(typeof s) ? "'" + s + "'" : s;
    }

    if(o.constructor === Array ){//数组
       for ( var i in o) {
           arr.push(fmt(o[i]));
       }
       return '[' + arr.join(',') + ']';
    } else{//普通JSON对象
       for ( var i in o) {
           arr.push("'" + i + "':" + fmt(o[i]));
    }
    return '{' + arr.join(',') + '}';
   }
}
// json 反序列化
var myObject = eval('('+jsonStr+')'); 
```

# PdfSharp打印功能

> 字体 [simfang.ttf](simfang.ttf) 

```c#
//构建PDF文档
using (PdfSharp.Pdf.PdfDocument pdfDocument = new PdfSharp.Pdf.PdfDocument())
{
	int pagecount=0;
	int fristCount=Index.Length>=18?18:Index.Length;
	//添加页面
	PdfSharp.Pdf.PdfPage page = pdfDocument.AddPage();
	//获取绘制对象
	PdfSharp.Drawing.XGraphics gfx = PdfSharp.Drawing.XGraphics.FromPdfPage(page);
	//文本布局对象
	//PdfSharp.Drawing.Layout.XTextFormatter tf = new PdfSharp.Drawing.Layout.XTextFormatter(gfx);
	
	//绘制画笔
	PdfSharp.Drawing.XPen pen= new PdfSharp.Drawing.XPen(PdfSharp.Drawing.XColors.Black, 0.6);
	//边距
	int marginLeft = 30;
    int marginTop = 20;
	
	//画个框
	PdfSharp.Drawing.XRect rect = new PdfSharp.Drawing.XRect(marginLeft, marginTop, page.Width - 2 * marginLeft, page.Height - 2 * marginTop);
	//标题
    //支持中文
	System.Drawing.Text.PrivateFontCollection pfcFonts = new System.Drawing.Text.PrivateFontCollection();
    string strFontPath = @"D:/install/Fonts/simfang.ttf";//字体设置为微软雅黑
    pfcFonts.AddFontFile(strFontPath);
	PdfSharp.Drawing.XPdfFontOptions options = new PdfSharp.Drawing.XPdfFontOptions(PdfSharp.Pdf.PdfFontEncoding.Unicode,PdfSharp.Pdf.PdfFontEmbedding.Always);
	//字体
	PdfSharp.Drawing.XFont font = new PdfSharp.Drawing.XFont(pfcFonts.Families[0],20,PdfSharp.Drawing.XFontStyle.Regular, options);
	PdfSharp.Drawing.XFont subfont = new PdfSharp.Drawing.XFont(pfcFonts.Families[0], 12, PdfSharp.Drawing.XFontStyle.Regular, options);
	//粗体
	PdfSharp.Drawing.XFont boldfont = new PdfSharp.Drawing.XFont(pfcFonts.Families[0], 10, PdfSharp.Drawing.XFontStyle.Bold, options);
	//小一点的字体
	PdfSharp.Drawing.XFont smallfont = new PdfSharp.Drawing.XFont(pfcFonts.Families[0], 8, PdfSharp.Drawing.XFontStyle.Regular, options);
	//Inflate(double width,double height);  
	//width是水平方向的，height是垂直方向的，当width和height的值为正数时是冷缩，为负数是膨胀。
	rect.Inflate(0, -10);
	
	gfx.DrawString("生产入库单", font, PdfSharp.Drawing.XBrushes.Red, rect, PdfSharp.Drawing.XStringFormats.TopCenter);
	
	//间距
	int padding_title = 30;
	int padding_row = 20;
	
	//所属工厂 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft, marginTop + padding_title + padding_row);
	
	gfx.DrawString("所属工厂："+Facility, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//第二行
	//入库单号 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft, marginTop + padding_title + padding_row * 2);
	gfx.DrawString("入库单号："+OrderNo, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//料框编码 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft + 180, marginTop + padding_title + padding_row * 2);
	gfx.DrawString("料框编码："+Container, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//入库仓库 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft + 315, marginTop + padding_title + padding_row * 2);
	gfx.DrawString("入库仓库："+Warehouse, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//第三行
	//请求料点 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft, marginTop + padding_title + padding_row * 3);
	gfx.DrawString("请求料点："+FromLocation, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//创建日期 rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft + 180, marginTop + padding_title + padding_row * 3);
	gfx.DrawString("创建日期："+CreateDate, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//创建用户 rect位置
    //rect.Location = new PdfSharp.Drawing.XPoint(marginLeft + 315, marginTop + padding_title + padding_row * 3);
	//gfx.DrawString("创建用户："+CreateUser, subfont, PdfSharp.Drawing.XBrushes.Black, rect, PdfSharp.Drawing.XStringFormats.TopLeft);
	
	//构造二维码
    #region QRCode
    var qrCodeMS = new System.IO.MemoryStream();
    ZXing.BarcodeWriter qrcodeWriter = new ZXing.BarcodeWriter();
    qrcodeWriter.Format = ZXing.BarcodeFormat.QR_CODE;//二维码format
	
	//入库单
	string st5 = OrderNo;
	if(!string.IsNullOrEmpty(st5))
	{				
	    qrcodeWriter.Write(OrderNo).Save(qrCodeMS, System.Drawing.Imaging.ImageFormat.Png);

	    PdfSharp.Drawing.XImage qrcodeImg = PdfSharp.Drawing.XImage.FromStream(qrCodeMS);
	    gfx.DrawImage(qrcodeImg, 450, 20, 140, 140);
	}
    #endregion
	
	//画表格  rect位置
    rect.Location = new PdfSharp.Drawing.XPoint(marginLeft, marginTop + 115);
	//表格高度
	double title_height = 20;
	double row_height = 30;
	
	//根据内容画表
	double table_height = title_height + fristCount * row_height;
	//表格方框
	PdfSharp.Drawing.XRect table_rect = new PdfSharp.Drawing.XRect(rect.X,rect.Y,rect.Width,table_height);
	gfx.DrawRectangle(pen, table_rect);
	
	//分成28份，权重-每一列的宽度
	double col_index = (table_rect.Width/28) * 2;
	double col_wiporderno = (table_rect.Width/28) * 4;
	double col_productno = (table_rect.Width/28) * 4;
	double col_productdesc = (table_rect.Width/28) * 8;
	double col_productalias = (table_rect.Width/28) * 4;
	double col_quantity = (table_rect.Width/28) * 2;
	double col_serialno = (table_rect.Width/28) * 4;
	
	//标题方框
    var countX = table_rect.X;
	
	PdfSharp.Drawing.XRect rect_title_index = new PdfSharp.Drawing.XRect(table_rect.X, 
		table_rect.Y, col_index, title_height);
	PdfSharp.Drawing.XRect rect_title_wiporderno = new PdfSharp.Drawing.XRect(table_rect.X + col_index, 
		table_rect.Y, col_wiporderno, title_height);
	PdfSharp.Drawing.XRect rect_title_productno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno, 
		table_rect.Y, col_productno, title_height);
	PdfSharp.Drawing.XRect rect_title_productdesc = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno, 
		table_rect.Y, col_productdesc, title_height);
	PdfSharp.Drawing.XRect rect_title_productalias = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc , 
		table_rect.Y, col_productalias, title_height);
	PdfSharp.Drawing.XRect rect_title_quantity = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc + col_productalias, 
		table_rect.Y, col_quantity, title_height);
	PdfSharp.Drawing.XRect rect_title_serialno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc + col_productalias + col_quantity, 
		table_rect.Y, col_serialno, title_height);
	//画格子边框
	gfx.DrawRectangle(pen, rect_title_index);
	gfx.DrawRectangle(pen, rect_title_wiporderno);
	gfx.DrawRectangle(pen, rect_title_productno);
	gfx.DrawRectangle(pen, rect_title_productdesc);
	gfx.DrawRectangle(pen, rect_title_productalias);
	gfx.DrawRectangle(pen, rect_title_quantity);
	gfx.DrawRectangle(pen, rect_title_serialno);
	//标题
	gfx.DrawString("序号", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_index, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("生产工单", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_wiporderno, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("物料编码", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_productno, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("物料描述", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_productdesc, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("物料简码", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_productalias, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("数量", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_quantity, PdfSharp.Drawing.XStringFormats.Center);
	gfx.DrawString("序列号", boldfont, PdfSharp.Drawing.XBrushes.Black, rect_title_serialno, PdfSharp.Drawing.XStringFormats.Center);
	//内容方框
	PdfSharp.Drawing.XRect rect_col_index,rect_col_wiporderno,rect_col_productno,rect_col_productdesc, rect_col_productalias, rect_col_quantity,rect_col_serialno;
	
	for(int i=0;i<fristCount;i++)
	{	
		double Height_Y = row_height * i;
		//格子位置
		rect_col_index = new PdfSharp.Drawing.XRect(table_rect.X, 
		table_rect.Y + title_height + Height_Y, col_index, row_height);
		rect_col_wiporderno = new PdfSharp.Drawing.XRect(table_rect.X + col_index, 
		table_rect.Y + title_height + Height_Y, col_wiporderno, row_height);
		rect_col_productno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno, 
		table_rect.Y + title_height + Height_Y, col_productno, row_height);
		rect_col_productdesc = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno, 
		table_rect.Y + title_height + Height_Y, col_productdesc, row_height);
		rect_col_productalias = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno  + col_productdesc, 
		table_rect.Y + title_height + Height_Y, col_productalias, row_height);
		rect_col_quantity = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc + col_productalias, 
		table_rect.Y + title_height + Height_Y, col_quantity, row_height);
		rect_col_serialno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc  + col_productalias + col_quantity, 
		table_rect.Y + title_height + Height_Y, col_serialno, row_height);
		//画格子边框
		gfx.DrawRectangle(pen, rect_col_index);
		gfx.DrawRectangle(pen, rect_col_wiporderno);
		gfx.DrawRectangle(pen, rect_col_productno);
		gfx.DrawRectangle(pen, rect_col_productdesc);
		gfx.DrawRectangle(pen, rect_col_productalias);
		gfx.DrawRectangle(pen, rect_col_quantity);
		gfx.DrawRectangle(pen, rect_col_serialno);
		//填充每一列的内容
		gfx.DrawString(Index[i].ToString("F0"), smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_index, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(WipOrderNo[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_wiporderno, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(ProductNo[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productno, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(ProductDesc[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productdesc, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(PRODUCTALIAS[i], subfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productalias, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(Quantity[i].ToString("F0"), subfont, PdfSharp.Drawing.XBrushes.Black, rect_col_quantity, PdfSharp.Drawing.XStringFormats.Center);
		gfx.DrawString(SerialNo[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_serialno, PdfSharp.Drawing.XStringFormats.Center);
		
	}

	//打印人 打印时间
	
	//数量大于18，添加PDF页面 
	if(Index.Length>18)
	{
		//判断需要生成几页PDF
		if(Index.Length-18%20==0)
		{
			pagecount=(Index.Length-18)/20;
		}
		else
		{
			pagecount=(Index.Length-18)/20+1;
		}
		//获取数据
		List<int> Indexdata=Index.ToList();
		List<string> WipOrderNodata=WipOrderNo.ToList();
		List<string> ProductDescdata=ProductDesc.ToList();
		List<string> ProductNodata=ProductNo.ToList();
		List<string> PRODUCTALIASdata=PRODUCTALIAS.ToList();
		List<decimal> Quantitydata=Quantity.ToList();
		List<string> SerialNodata=SerialNo.ToList();
		for(int j=0;j<pagecount;j++)
		{
			//创建用于获取未填充至PDF的数据List
				List<int> IndexArr=new List<int>();
				List<string> WipOrderNoArr=new List<string>();
				List<string> ProductDescArr=new List<string>();
				List<string> ProductNoArr=new List<string>();
			    List<string> PRODUCTALIASArr=new List<string>();
				List<decimal> QuantityArr=new List<decimal>();
				List<string> SerialNoArr=new List<string>();
			//分页（每页20条数据，第一页18条） 判断剩下的数据是否超过20条
			if(Indexdata.Skip(18).Skip(20*j).ToArray().Length>=20)
			{
				 IndexArr=Indexdata.Skip(18).Skip(20*j).Take(20).ToList();
				 WipOrderNoArr=WipOrderNodata.Skip(18).Skip(20*j).Take(20).ToList();
				 ProductDescArr=ProductDescdata.Skip(18).Skip(20*j).Take(20).ToList();
				 ProductNoArr=ProductNodata.Skip(18).Skip(20*j).Take(20).ToList();
				 QuantityArr=Quantitydata.Skip(18).Skip(20*j).Take(20).ToList();
				 SerialNoArr=SerialNodata.Skip(18).Skip(20*j).Take(20).ToList();
				 PRODUCTALIASArr=PRODUCTALIASdata.Skip(18).Skip(20*j).Take(20).ToList();
			}
			else
			{
				 IndexArr=Indexdata.Skip(18).Skip(20*j).ToList();
				 WipOrderNoArr=WipOrderNodata.Skip(18).Skip(20*j).ToList();
				 ProductDescArr=ProductDescdata.Skip(18).Skip(20*j).ToList();
				 ProductNoArr=ProductNodata.Skip(18).Skip(20*j).ToList();
				 QuantityArr=Quantitydata.Skip(18).Skip(20*j).ToList();
				 SerialNoArr=SerialNodata.Skip(18).Skip(20*j).ToList();
				 PRODUCTALIASArr=PRODUCTALIASdata.Skip(18).Skip(20*j).ToList();
			}
			
		
	//添加页面
	PdfSharp.Pdf.PdfPage page2 = pdfDocument.AddPage();
	//获取绘制对象
	PdfSharp.Drawing.XGraphics gfx2 = PdfSharp.Drawing.XGraphics.FromPdfPage(page2);
	//文本布局对象



	
	
	
	for(int i=0;i<IndexArr.Count;i++)
	{	
		double Height_Y = row_height * i;
		//格子位置
		rect_col_index = new PdfSharp.Drawing.XRect(table_rect.X, 
		table_rect.Y + title_height + Height_Y, col_index, row_height);
		rect_col_wiporderno = new PdfSharp.Drawing.XRect(table_rect.X + col_index, 
		table_rect.Y + title_height + Height_Y, col_wiporderno, row_height);
		rect_col_productno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno, 
		table_rect.Y + title_height + Height_Y, col_productno, row_height);
		rect_col_productdesc = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno, 
		table_rect.Y + title_height + Height_Y, col_productdesc, row_height);
		rect_col_productalias = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno  + col_productdesc, 
		table_rect.Y + title_height + Height_Y, col_productalias, row_height);
		rect_col_quantity = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc + col_productalias, 
		table_rect.Y + title_height + Height_Y, col_quantity, row_height);
		rect_col_serialno = new PdfSharp.Drawing.XRect(table_rect.X + col_index + col_wiporderno + col_productno + col_productdesc + col_productalias +  col_quantity, 
		table_rect.Y + title_height + Height_Y, col_serialno, row_height);
		//画格子边框
		gfx2.DrawRectangle(pen, rect_col_index);
		gfx2.DrawRectangle(pen, rect_col_wiporderno);
		gfx2.DrawRectangle(pen, rect_col_productno);
		gfx2.DrawRectangle(pen, rect_col_productdesc);
	    gfx2.DrawRectangle(pen, rect_col_productalias);
		gfx2.DrawRectangle(pen, rect_col_quantity);
		gfx2.DrawRectangle(pen, rect_col_serialno);
		//填充每一列的内容
		gfx2.DrawString(IndexArr[i].ToString("F0"), smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_index, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(WipOrderNoArr[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_wiporderno, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(ProductNoArr[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productno, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(ProductDescArr[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productdesc, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(PRODUCTALIASArr[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_productalias, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(QuantityArr[i].ToString("F0"), smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_quantity, PdfSharp.Drawing.XStringFormats.Center);
		gfx2.DrawString(SerialNoArr[i], smallfont, PdfSharp.Drawing.XBrushes.Black, rect_col_serialno, PdfSharp.Drawing.XStringFormats.Center);
		
	}	
			
			if(j.Equals(pagecount-1))
			{
				
				string systime = DateTime.Now.ToString();
				PdfSharp.Drawing.XRect rect_print = new PdfSharp.Drawing.XRect(rect.Width / 2 + 15, 
				table_rect.Y + title_height + row_height * IndexArr.Count + 15, rect.Width / 2, title_height);

				gfx2.DrawString("打印人："+PrintUser+"  打印日期："+systime, subfont, PdfSharp.Drawing.XBrushes.Black, rect_print, PdfSharp.Drawing.XStringFormats.TopLeft);
			}
		}
	}
	else
	{
			string systime = DateTime.Now.ToString();
				PdfSharp.Drawing.XRect rect_print = new PdfSharp.Drawing.XRect(rect.Width / 2 + 15, 
				table_rect.Y + title_height + row_height * fristCount + 15, rect.Width / 2, title_height);

				gfx.DrawString("打印人："+PrintUser+"  打印日期："+systime, subfont, PdfSharp.Drawing.XBrushes.Black, rect_print, PdfSharp.Drawing.XStringFormats.TopLeft);
	}
	
	
	
	
	
	//保存路径
	string savePath = FlexNet.SystemServices.FrameworkSettings.Current.FlexNetResourcesPath+"\\PDF2Print";
    //生成最终pdf文件
    pdfName = "ProductionEntry"+OrderNo;				
	var saveURL = savePath + "\\" + pdfName + ".pdf";
	var isExists = System.IO.File.Exists(saveURL);
	if(!isExists){
		//System.IO.File.Delete(saveURL);
		pdfDocument.Save(saveURL);
	}
    else{
		Random ra = new Random();
		pdfName = "ProductionEntry"+OrderNo+"_" + ra.Next(0,100);
		saveURL = savePath + "\\" + pdfName + ".pdf";
		pdfDocument.Save(saveURL);
	}
}
```

# CSharp创建流水号

```c#
int sn = 0;  //序号
DateTime t = DateTime.Now;  //获取今天的日期
// 拼接流水号
string strSN = t.ToString("yyyyMMdd") + string.Format("{0:d4}", sn);
```

